# Kind ê¸°ë°˜ ë¡œì»¬ í…ŒìŠ¤íŠ¸ì™€ ì‹¤ìš´ì˜ Kubernetes ë°°í¬ ê°€ëŠ¥ ì„¤ê³„

# - ë°°ì¹˜ êµ¬ì„±: Spring Batch Job (2ê°œ) + SCDF Task ê¸°ë°˜ Spring Batch (1ê°œ)
# - ëª©ì : ì™¸ë¶€ DB â†’ ë°ì´í„° ì¶”ì¶œ â†’ ë³€í™˜ â†’ InfluxDB ì €ì¥ â†’ Grafana/Prometheus ì‹œê°í™”
# - Helm ê¸°ë°˜ìœ¼ë¡œ ë°°í¬, Kindì—ì„œ í…ŒìŠ¤íŠ¸ í›„ K8s ìš´ì˜ ë°˜ì˜
#
# - kubectl apply -f test-job.yaml
# - kubectl get pods -o wide
# - kubectl logs job/test-job
# - Kubectl get nodes : ë…¸ë“œì´ë¦„ í™•ì¸
#
# - kubectl taint nodes <ë…¸ë“œì´ë¦„> <key>=<value>:<effect>
# - nodes : ë¦¬ì†ŒìŠ¤ ìœ í˜• (taintë¥¼ ì„¤ì •í•  ëŒ€ìƒì€ node)
# - <effect> : NoSchedule, PreferNoSchedule, NoExecute (taintì˜ ë™ì‘ ë°©ì‹)
# - NoSchedule : ì¡°ê±´ì„ ë§Œì¡±í•˜ì§€ ì•Šìœ¼ë©´ ì ˆëŒ€ ìŠ¤ì¼€ì¤„ë˜ì§€ ì•ŠìŒ
# - PreferNoSchedule : ê°€ëŠ¥í•˜ë©´ ìŠ¤ì¼€ì¤„ ì•ˆ í•˜ì§€ë§Œ, ë¶ˆê°€í”¼í•˜ë©´ ë°°ì¹˜ ê°€ëŠ¥
# - NoExecute : ì¡°ê±´ ë¶ˆë§Œì¡± ì‹œ ê¸°ì¡´ì— ìˆë˜ Podë„ í‡´ì¶œë¨
# - kubectl taint nodes love-cluster-worker role=work-1:NoSchedule
# - kubectl taint nodes love-cluster-worker type=job:NoSchedule
#
# - kubectl label nodes love-cluster-worker name=oppa-love-node
# - kubectl get nodes --show-labels
# - kubectl label node love-cluster-worker emoji=ğŸ’—
# # ì¸í”„ë¼ ì„¤ì¹˜
#helm install infra ./infra -f values-infra.yaml

# ë°°ì¹˜ ì¡(Job) ì•± ë°°í¬
#helm install job ./batch-job -f values-job.yaml

# SCDF Task ì•± ë°°í¬
#helm install task ./batch-task -f values-task.yaml

Release:
  Name: "default"
  Service: "spring-batch"

batchJobs:
  enabled: true
  jobs:
    - name: batch-job-01
      replicaCount: 1
      image: # neo-batch-job:0.0.1
        repository: neo-batch-job
        tag: 0.0.1
        pullPolicy: IfNotPresent
          # Always : ë§¤ë²ˆ ìƒˆ ì´ë¯¸ì§€ Pull (latest íƒœê·¸ë‚˜ ê°œë°œ í™˜ê²½ì—ì„œ)
          # IfNotPresent : ë¡œì»¬ì— ì—†ìœ¼ë©´ Pull (í…ŒìŠ¤íŠ¸ / ë°°í¬ìš© ê°œë°œ ì´ë¯¸ì§€)
          # Never : ì ˆëŒ€ Pull ì•ˆ í•¨ (ë¡œì»¬ì—ì„œ ë§Œë“  ì´ë¯¸ì§€ë§Œ ì‚¬ìš©í•  ë•Œ(Kind ë“±)
      restartPolicy: Never   # Jobì´ ì‹¤íŒ¨í•´ë„ ìë™ ì¬ì‹œì‘í•˜ì§€ ì•ŠìŒ (ì¼íšŒì„± ì‘ì—…)
        # ì£¼ê¸°ì ì¸ batch job ì‹¤í–‰ í›„ ì¢…ë£Œë˜ëŠ” ê²½ìš°
        # Always : í•­ìƒ ì¬ ì‹œì‘ (Deployment)
        # OnFailure : ì‹¤íŒ¨ ì‹œ ì¬ ì‹œì‘ (Job / Pod)
        # Never : ì ˆëŒ€ ì¬ ì‹œì‘ ì•ˆí•¨ (Job / Pod)
      datasource: # ì™¸ë¶€ì˜ dbë¥¼ sql íŒ¨ì¹˜ ë° í˜ì´ì§•í•˜ì—¬ read ì‹œ ì‚¬ìš© (í˜„ì¬ëŠ” ë¯¸ì‚¬ìš©. í–¥í›„ ìš´ì˜ ì‹œ ë‚´ìš© ë³€ê²½ í•„ìš”)
        driver_class_name: com.mysql.cj.jdbc.Driver 
        url: jdbc:mysql://job01-datasource.default.svc.cluster.local:3306/jobdb
        username: user
        password: root
      datasource_sub: # ì™¸ë¶€ì˜ dbë¥¼ sql íŒ¨ì¹˜ ë° í˜ì´ì§•í•˜ì—¬ read ì‹œ ì‚¬ìš© (í˜„ì¬ëŠ” ë¯¸ì‚¬ìš©. í–¥í›„ ìš´ì˜ ì‹œ ë‚´ìš© ë³€ê²½ í•„ìš”)
        enabled: true
        driver_class_name: com.mysql.cj.jdbc.Driver 
        url: jdbc:mysql://job01-datasource-sub.default.svc.cluster.local:3306/jobdb
        username: user
        password: root
      influx:
        url: http://influxdb:8086
        logLevel: BODY
        readTimeout: 5s
        writeTimeout: 5s
        connectTimeout: 5s
      env: 
        - name: springProfile
          value: local 
        - name: jobCron 
          value: "0 */5 * * *" 
          # 5ë¶„ ì£¼ê¸° (ì„¤ì •ìˆœì„œ : ë¶„ ì‹œ ì¼ ì›” ìš”ì¼)
      command:     # ["java", "-jar", "/app/app.jar"]
        - "--rtm.batch.job.start=202507091730"
        - "--rtm.batch.job.end=202507091740"
        - "--rtm.batch.job.chunk=200"
        - "--rtm.batch.job.interval=10"
        - "--rtm.batch.job.delay=5"
      service:
        enabled: true;                # false ì¸ ê²½ìš° ServiceëŠ” í•„ìš” ì—†ìŒ (taskëŠ” ë‹¨ë°œì„± ì‹¤í–‰ì´ë¯€ë¡œ í†µì‹  ë…¸ì¶œ ë¶ˆí•„ìš”)
        type: ClusterIP               # ë‚´ë¶€ í´ëŸ¬ìŠ¤í„°ìš© ì„œë¹„ìŠ¤ íƒ€ì…(K8së‚´ë¶€ì—ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥)
        port: 8080                    # ê¸°ë³¸ ì„œë¹„ìŠ¤ í¬íŠ¸
      resources:
        limits:
          cpu: 500m
          memory: 512Mi
        requests:
          cpu: 250m
          memory: 256Mi
      nodeSelector:                   # í•´ë‹¹ Podê°€ ë°°ì¹˜ë  Nodeë¥¼ labelë¡œ ì§€ì •
        role: work-1                  # label key: 'role', value: 'work-1' ì¸ ë…¸ë“œì—ë§Œ ë°°ì¹˜
      affinity:                       # (ì„ íƒì‚¬í•­) NodeAffinity / PodAffinity ë“± ì •êµí•œ ë°°ì¹˜ ì „ëµ
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
              - matchExpressions:
                - key: role
                  operator: In
                  values:
                    - work-1          # ì´ ì¡°ê±´ì€ nodeSelectorì™€ ë™ì¼í•œ íš¨ê³¼ì§€ë§Œ ë” ìœ ì—°í•¨
      tolerations:                    # Taintsê°€ ê±¸ë¦° ë…¸ë“œì—ë„ í•´ë‹¹ ì¡°ê±´ì„ ë§Œì¡±í•˜ë©´ ë°°ì¹˜ í—ˆìš© (kubectl taint nodes work-1 type=job:NoSchedule)
        - key: "type"                 # ë…¸ë“œì— taintë¡œ ì„¤ì •ëœ key
          operator: "Equal"           # ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” ê°’ì¼ ë•Œë§Œ í—ˆìš©
          value: "job"                # í•´ë‹¹ ê°’ì´ "job"ì¼ ê²½ìš°ë§Œ ì´ PodëŠ” ìŠ¤ì¼€ì¤„ë§ í—ˆìš©ë¨
          effect: "NotSchedule"       # taintê°€ NoSchedule ì¼ ë•Œ ì´ tolerationì´ ì—†ìœ¼ë©´ ë°°ì¹˜ ì•ˆ ë¨
      volumeMounts:
        - name: config-volume
          mountPath: /config          # ì„¤ì •íŒŒì¼ì´ ë§ˆìš´íŠ¸ë  ê²½ë¡œ
          readOnly: true              # ì½ê¸° ì „ìš©
      volumes:
        - name: config-volume
          configMap:                  # volumeMounts + volumes : application.yml ë˜ëŠ” application-prod.yml ë“± Spring Boot ì•± ì„¤ì •íŒŒì¼ì„ Kubernetes ConfigMapìœ¼ë¡œ ë§Œë“¤ì–´ì„œ Pod ë‚´ë¶€ì— ë§ˆìš´íŠ¸í•´ ì‚¬ìš©í•˜ê¸° ìœ„í•¨ 
            name: batch-job-01-config # ì°¸ì¡°í•  ConfigMap ì´ë¦„ (batch job appì˜ JVM ì‹¤í–‰ ì‹œ --spring.config.additional-location=/config/ ì˜µì…˜ì„ í†µí•´ ì´ íŒŒì¼ì„ ì½ê²Œ í•  ìˆ˜ ìˆë‹¤.
      configMap:                      # ConfigMap ë§Œë“œëŠ” ë°©ë²• : kubectl create configmap batch-job-01-config --from-file=application.yml (ì´í›„, Helmì—ì„œëŠ” configMap.name: batch-job-01-configìœ¼ë¡œ ì°¸ì¡°í•˜ë©´ ëœë‹¤)
        enabled: true
        name: batch-job-01-config
        files:
          - application.yaml
      livenessProbe:                  # ì•±ì´ ì‚´ì•„ ìˆëŠ”ì§€ í™•ì¸(ì£½ì—ˆìœ¼ë©´ ìë™ ì¬ ì‹œì‘)
        httpGet:
          path: /actuator/health/liveness # Spring Boot actuatorì˜ /health/liveness ì•¤ë“œí¬ì¸íŠ¸ë¥¼ ì‚¬ìš©
          port: 8080
        initialDelaySeconds: 30
        periodSeconds: 10
      readinessProbe:                 # ì•±ì´ ì¤€ë¹„ëëŠ”ì§€ í™•ì¸(ì¤€ë¹„ë˜ê¸° ì „ì—ëŠ” íŠ¸ë˜í”½ ì°¨ë‹¨)
        httpGet:
          path: /actuator/health/readiness
          port: 8080
        linitialDelaySeconds: 15
        periodSeconds: 5

    - name: batch-job-02
      replicaCount: 1
      image:
        repository: neo-batch-job
        tag: 0.0.1
        pullPolicy: IfNotPresent
      restartPolicy: Never
      datasource: # ì™¸ë¶€ì˜ dbë¥¼ sql íŒ¨ì¹˜ ë° í˜ì´ì§•í•˜ì—¬ read ì‹œ ì‚¬ìš© (í˜„ì¬ëŠ” ë¯¸ì‚¬ìš©. í–¥í›„ ìš´ì˜ ì‹œ ë‚´ìš© ë³€ê²½ í•„ìš”)
        driver_class_name: com.mysql.cj.jdbc.Driver 
        url: jdbc:mysql://job02-datasource.default.svc.cluster.local:3306/jobdb
        username: user
        password: root
      datasource_sub: # ì™¸ë¶€ì˜ dbë¥¼ sql íŒ¨ì¹˜ ë° í˜ì´ì§•í•˜ì—¬ read ì‹œ ì‚¬ìš© (í˜„ì¬ëŠ” ë¯¸ì‚¬ìš©. í–¥í›„ ìš´ì˜ ì‹œ ë‚´ìš© ë³€ê²½ í•„ìš”)
        enabled: true
        driver_class_name: com.mysql.cj.jdbc.Driver 
        url: jdbc:mysql://job02-datasource-sub.default.svc.cluster.local:3306/jobdb
        username: user
        password: root
      influx:
        url: http://influxdb:8086
        logLevel: BODY
        readTimeout: 5s
        writeTimeout: 5s
        connectTimeout: 5s
      env: 
        - name: springProfile
          value: local 
        - name: jobCron 
          value: "0 */5 * * *" 
      command: 
        - "--rtm.batch.job.start=202507091730"
        - "--rtm.batch.job.end=202507091740"
        - "--rtm.batch.job.chunk=200"
        - "--rtm.batch.job.interval=10"
        - "--rtm.batch.job.delay=5"
      service:
        enabled: true;                # false ì¸ ê²½ìš° ServiceëŠ” í•„ìš” ì—†ìŒ (taskëŠ” ë‹¨ë°œì„± ì‹¤í–‰ì´ë¯€ë¡œ í†µì‹  ë…¸ì¶œ ë¶ˆí•„ìš”)
        type: ClusterIP               # ë‚´ë¶€ í´ëŸ¬ìŠ¤í„°ìš© ì„œë¹„ìŠ¤ íƒ€ì…(K8së‚´ë¶€ì—ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥)
        port: 8081
      resources:
        limits:
          cpu: 500m
          memory: 512Mi
        requests:
          cpu: 250m
          memory: 256Mi
      nodeSelector:
        role: work-1
      affinity:                       # (ì„ íƒì‚¬í•­) NodeAffinity / PodAffinity ë“± ì •êµí•œ ë°°ì¹˜ ì „ëµ
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
              - matchExpressions:
                - key: role
                  operator: In
                  values:
                    - work-1          # ì´ ì¡°ê±´ì€ nodeSelectorì™€ ë™ì¼í•œ íš¨ê³¼ì§€ë§Œ ë” ìœ ì—°í•¨
      tolerations:                    # Taintsê°€ ê±¸ë¦° ë…¸ë“œì—ë„ í•´ë‹¹ ì¡°ê±´ì„ ë§Œì¡±í•˜ë©´ ë°°ì¹˜ í—ˆìš©
        - key: "type"                 # ë…¸ë“œì— taintë¡œ ì„¤ì •ëœ key
          operator: "Equal"           # ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” ê°’ì¼ ë•Œë§Œ í—ˆìš©
          value: "job"                # í•´ë‹¹ ê°’ì´ "job"ì¼ ê²½ìš°ë§Œ ì´ PodëŠ” ìŠ¤ì¼€ì¤„ë§ í—ˆìš©ë¨
          effect: "NotSchedule"       # taintê°€ NoSchedule ì¼ ë•Œ ì´ tolerationì´ ì—†ìœ¼ë©´ ë°°ì¹˜ ì•ˆ ë¨
      volumeMounts:
        - name: config-volume
          mountPath: /config          # ì„¤ì •íŒŒì¼ì´ ë§ˆìš´íŠ¸ë  ê²½ë¡œ
          readOnly: true              # ì½ê¸° ì „ìš©
      volumes:
        - name: config-volume
          configMap:
            name: batch-job-02-config    # ì°¸ì¡°í•  ConfigMap ì´ë¦„
      configMap:
        enabled: true
        name: batch-job-02-config
        files:
          - application.yaml
      livenessProbe:
        httpGet:
          path: /actuator/health/liveness
          port: 8080
        initialDelaySeconds: 30
        periodSeconds: 10
      readinessProbe:
        httpGet:
          path: /actuator/health/readiness
          port: 8080
        linitialDelaySeconds: 15
        periodSeconds: 5

batchTasks:
  enabled: true
  tasks:
    - name: batch-task-01
      replicaCount: 1
      image:
        repository: neo-batch-task
        tag: 0.0.1
        pullPolicy: IfNotPresent
      restartPolicy: Never
      datasource: # ì™¸ë¶€ì˜ dbë¥¼ sql íŒ¨ì¹˜ ë° í˜ì´ì§•í•˜ì—¬ read ì‹œ ì‚¬ìš© (í˜„ì¬ëŠ” ë¯¸ì‚¬ìš©. í–¥í›„ ìš´ì˜ ì‹œ ë‚´ìš© ë³€ê²½ í•„ìš”)
        url: jdbc:mysql://task01-datasource.default.svc.cluster.local:3306/taskdb
        username: user
        password: root
      datasource_sub: # ì™¸ë¶€ì˜ dbë¥¼ sql íŒ¨ì¹˜ ë° í˜ì´ì§•í•˜ì—¬ read ì‹œ ì‚¬ìš© (í˜„ì¬ëŠ” ë¯¸ì‚¬ìš©. í–¥í›„ ìš´ì˜ ì‹œ ë‚´ìš© ë³€ê²½ í•„ìš”)
        enabled: false
        driver_class_name: com.mysql.cj.jdbc.Driver 
        url: jdbc:mysql://task01-datasource-sub.default.svc.cluster.local:3306/taskdb
        username: user
        password: root
      influx:
        url: http://influxdb:8086
        logLevel: BODY
        readTimeout: 5s
        writeTimeout: 5s
        connectTimeout: 5s
      arguments:
        - "--runDate=2025-07-10" 
          # task launch my-batch-task --arguments "--runData=2005-07-10" ì‹œ 
          # spring.batch.job.enabled=true ì¼ ê²½ìš°, ìë™ìœ¼ë¡œ JobParameterë¡œ ì¸ì‹
          # JobLauncherApplicationRunnerê°€ ìë™ ì‹¤í–‰
      env:
        - name: SPRING_PROFILES_ACTIVE
          value: "local"
        - name: TASK_EXECUTION_ID
          value: "ID0001"
        - name: task_name
          value: "batch_task_01"
        - name: springProfile
          value: local
        - name: jobCron
          value: "0 */5 * * *" 
      command: 
        - "--spring.cloud.task.name=task01"
        - "--rtm.batch.job.start=202507091730"
        - "--rtm.batch.job.end=202507091740"
        - "--rtm.batch.job.chunk=200"
        - "--rtm.batch.job.interval=10"
        - "--rtm.batch.job.delay=5"
      service:
        enabled: true;                # false ì¸ ê²½ìš° ServiceëŠ” í•„ìš” ì—†ìŒ (taskëŠ” ë‹¨ë°œì„± ì‹¤í–‰ì´ë¯€ë¡œ í†µì‹  ë…¸ì¶œ ë¶ˆí•„ìš”) í˜„ì¬ëŠ” í…ŒìŠ¤íŠ¸ ëª©ì ìœ¼ë¡œ trueë¡œ í•´ì„œ í…ŒìŠ¤íŠ¸ í•´ë´„.
        type: ClusterIP               # ë‚´ë¶€ í´ëŸ¬ìŠ¤í„°ìš© ì„œë¹„ìŠ¤ íƒ€ì…(K8së‚´ë¶€ì—ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥)
        port: 8090
      resources:
        limits:
          cpu: 500m
          memory: 512Mi
        requests:
          cpu: 250m
          memory: 256Mi
      nodeSelector:
        role: work-2
      affinity:                       # (ì„ íƒì‚¬í•­) NodeAffinity / PodAffinity ë“± ì •êµí•œ ë°°ì¹˜ ì „ëµ
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
              - matchExpressions:
                - key: role
                  operator: In
                  values:
                    - work-2          # ì´ ì¡°ê±´ì€ nodeSelectorì™€ ë™ì¼í•œ íš¨ê³¼ì§€ë§Œ ë” ìœ ì—°í•¨
      tolerations:                    # Taintsê°€ ê±¸ë¦° ë…¸ë“œì—ë„ í•´ë‹¹ ì¡°ê±´ì„ ë§Œì¡±í•˜ë©´ ë°°ì¹˜ í—ˆìš©
        - key: "type"                 # ë…¸ë“œì— taintë¡œ ì„¤ì •ëœ key
          operator: "Equal"           # ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” ê°’ì¼ ë•Œë§Œ í—ˆìš©
          value: "task"                # í•´ë‹¹ ê°’ì´ "task"ì¼ ê²½ìš°ë§Œ ì´ PodëŠ” ìŠ¤ì¼€ì¤„ë§ í—ˆìš©ë¨
          effect: "NotSchedule"       # taintê°€ NoSchedule ì¼ ë•Œ ì´ tolerationì´ ì—†ìœ¼ë©´ ë°°ì¹˜ ì•ˆ ë¨
      volumeMounts:
        - name: config-volume
          mountPath: /config          # ì„¤ì •íŒŒì¼ì´ ë§ˆìš´íŠ¸ë  ê²½ë¡œ
          readOnly: true              # ì½ê¸° ì „ìš©
      volumes:
        - name: config-volume
          configMap:
            name: batch-task-01-config    # ì°¸ì¡°í•  ConfigMap ì´ë¦„
      configMap:
        enabled: true
        name: batch-task-01-config
        files:
          - application.yaml
      livenessProbe:
        httpGet:
          path: /actuator/health/liveness
          port: 8080
        initialDelaySeconds: 30
        periodSeconds: 10
      readinessProbe:
        httpGet:
          path: /actuator/health/readiness
          port: 8080
        linitialDelaySeconds: 15
        periodSeconds: 5

mysql:
  enabled: true
  image:
    repository: mysql
    tag: "8.0"
    pullPolicy: IfNotPresent
  env:
    - name: rootPassword
      value: root
    - name: database
      value: demo
    - name: username
      value: neodain
    - name: password
      value: Kht72@eye1
  resources:
    limits:
      memory: 2048Mi
      cpu: 1000m
    requests:
      memory: 1024Mi
      cpu: 500m
  service:
    port: 3306
    nodePort: 3307
  persistence:
    enabled: true             # false : ë””ìŠ¤í¬ ì‚¬ìš©ì•ˆí•¨(ì¼ì‹œì ì¸ í…ŒìŠ¤íŠ¸ ì‹œ)
    mountPath: /var/lib/mysql
    existingClaim: mysql-pvc  # ì´ë¯¸ í´ëŸ¬ìŠ¤í„°ì— ìƒì„±ëœ mysql-pvcë¼ëŠ” PVCë¥¼ ì‚¬ìš©
    # size: 2Gi                 # persistence.enabled: true, storageClass, size ì„¤ì • : PVCë¥¼ Helm Chart ì•ˆì—ì„œ ë™ì ìœ¼ë¡œ ìƒì„±
  nodeSelector:
    role: work-1

mariadb:
  enabled: true
  image:
    repository: mariadb
    tag: "10"
    pullPolicy: IfNotPresent
  env:
    - name: rootPassword
      value: root
    - name: database
      value: demo
    - name: username
      value: neodain
    - name: password
      value: Kht72@eye1
  service:
    port: 3306
    nodePort: 3308
  persistence:
    enabled: true
    mountPath: /var/lib/mysql
    existingClaim: mariadb-pvc
    size: 2Gi
  nodeSelector:
    role: work-2

influxdb:
  enabled: true
  image:
    repository: influxdb
    tag: latest
    pullPolicy: IfNotPresent
  env:
    - name: DOCKER_INFLUXDB_INIT_MODE
      value: setup
    - name: DOCKER_INFLUXDB_INIT_USERNAME
      value: neodain
    - name: DOCKER_INFLUXDB_INIT_PASSWORD
      value: Kht72@eye1
    - name: DOCKER_INFLUXDB_INIT_ORG
      value: neodain
    - name: DOCKER_INFLUXDB_INIT_BUCKET
      value: neodain
    - name: DOCKER_INFLUXDB_INIT_ADMIN_TOKEN
      value: xxxxxxxxxxxxxxxx 
  service:
    port: 8086
    nodePort: 8087
  persistence:
    enabled: true
    mountPath: /var/lib/influxdb2
    existingClaim: influxdb-pvc
    size: 2Gi
  nodeSelector:
    role: control

grafana:
  enabled: true
  image:
    repository: grafana/grafana
    tag: latest
    pullPolicy: IfNotPresent
  service:
    port: 3000
    nodePort: 3001
  persistence:
    enabled: true
    mountPath: /var/lib/grafana
    existingClaim: grafana-pvc
  dependsOn:
    - influxdb
  admin: 
    # existingSecret: grafana-admin-secret
    user: admin
    password: admin
  nodeSelector:
    role: control
  datasources:
    datasources.yaml:
      apiVersion: 1
      datasources:
        - name: Prometheus
          type: prometheus
          url: http://prometheus-server
          access: proxy
          isDefault: true
        - name: InfluxDB
          type: influxdb
          url: http://influxdb:8086
          access: proxy
          database: mybucket

prometheus:
  enabled: true
  image:
    repository: bitnami/prometheus 
    tag: latest
  server:
    resources:
      requests:
        memory: 256Mi
        cpu: 100m
      limits:
        memory: 512Mi
        cpu: 250m
    persistentVolume:
      enabled: true
      storageClass: standard
      size: 8Gi
    nodeSelector:
      role: control 


# âœ¨ SCDF ê´€ë ¨ ì„¤ì •
scdf:
  enabled: true
  image:
    repository: bitnami/spring-cloud-dataflow 
    tag: 2.11.5
    pullPolicy: IfNotPresent
  server:
    service:
      type: NodePort 
      port: 31000 
    resource:
      limits:
        memory: 2048Mi
        cpu: 1000m
      requests:
        memory: 1024Mi
        cpu: 500m
    nodeSelector:
      role: control
    mariadb:
      enabled: false                            # ë‚´ë¶€ mariadb ë¹„ í™œì„±í™”
    externalDatabase:    
      host: mariadb.default.svc.cluster.local   # DNS ì´ë¦„:<service-name>.<namespace>.svc.cluster.local
      port: 3306
      database: demo
      user: neodain
      password: Kht72@eye1
      database: demo
  skipper:
    enabled: true
    image:
      repository: bitnami/spring-cloud-skipper
      tag: 2.11.5
      pullPolicy: IfNotPresent
    service:
      type: NodePort
      nodePort: 31080
    resource:
      limits:
        memory: 1024Mi
        cpu: 500m
      requests:
        memory: 512Mi
        cpu: 250m
    nodeSelector:
      role: control
  dataflow:
    server:
      database:
        type: mariadb
  config:
    spring:
      datasource:
        url: jdbc:mariadb://mariadb.default.svc.cluster.local:3306/scdf_meta
        username: scdf
        password: scdfpass
        driverClassName: org.mariadb.jdbc.Driver
      cloud:
        dataflow:
          task:
            platform:
              kubernetes:
                accounts:
                  default:
                    namespace: default
                    imagePullPolicy: IfNotPresent
  features:
    streaming:
      enabled: false
    rabbitmq:
      enabled: false
