# ğŸ§¾ ì¶”ê°€ ê³ ë ¤ ì‚¬í•­ ë°˜ì˜: ì‹¤ë¬´í˜• Helm ë°°í¬ ì„¤ê³„ ê¸°ë°˜ values.yaml
# Kind ê¸°ë°˜ ë¡œì»¬ í…ŒìŠ¤íŠ¸ì™€ ì‹¤ìš´ì˜ Kubernetes ë°°í¬ ê°€ëŠ¥ ì„¤ê³„

# âœ… ì „ì²´ ì•„í‚¤í…ì²˜ ê°œìš”:
# - ë°°ì¹˜ êµ¬ì„±: Spring Batch Job (10ê°œ) + SCDF Task ê¸°ë°˜ Spring Batch (10ê°œ)
# - ëª©ì : ì™¸ë¶€ DB â†’ ë°ì´í„° ì¶”ì¶œ â†’ ë³€í™˜ â†’ InfluxDB ì €ì¥ â†’ Grafana/Prometheus ì‹œê°í™”
# - Helm ê¸°ë°˜ìœ¼ë¡œ ë°°í¬, Kindì—ì„œ í…ŒìŠ¤íŠ¸ í›„ K8s ìš´ì˜ ë°˜ì˜

Release:
  Name: "rel"
  Service: "spring-batch"

mysql:
  enabled: true
  image:
    repository: mysql
    tag: "8.0"
  auth:
    rootPassword: root
    database: demo
    username: neodain
    password: Kht72@eye1
  service:
    port: 3306
    nodePort: 3307
  persistence:
    enabled: true
    mountPath: /var/lib/mysql
    existingClaim: mysql-pvc
  nodeSelector:
    role: work

mariadb:
  enabled: true
  image:
    repository: mariadb
    tag: "10"
  auth:
    rootPassword: root
    database: demo
    username: neodain
    password: Kht72@eye1
  service:
    port: 3306
    nodePort: 3308
  persistence:
    enabled: true
    mountPath: /var/lib/mysql
    existingClaim: mariadb-pvc
  nodeSelector:
    role: work

influxdb:
  enabled: true
  image:
    repository: influxdb
    tag: latest
  env:
    - name: DOCKER_INFLUXDB_INIT_MODE
      value: setup
    - name: DOCKER_INFLUXDB_INIT_USERNAME
      value: neodain
    - name: DOCKER_INFLUXDB_INIT_PASSWORD
      value: Kht72@eye1
    - name: DOCKER_INFLUXDB_INIT_ORG
      value: neodain
    - name: DOCKER_INFLUXDB_INIT_BUCKET
      value: neodain
    - name: DOCKER_INFLUXDB_INIT_ADMIN_TOKEN
      value: xxxxxx 
  service:
    port: 8086
    nodePort: 8087
  persistence:
    enabled: true
    mountPath: /var/lib/influxdb2
    existingClaim: influxdb-pvc
  nodeSelector:
    role: main

grafana:
  enabled: true
  image:
    repository: grafana/grafana
    tag: latest
  service:
    port: 3000
    nodePort: 3001
  persistence:
    enabled: true
    mountPath: /var/lib/grafana
    existingClaim: grafana-pvc
  dependsOn:
    - influxdb
  nodeSelector:
    role: main

# ğŸ¯ ì‹¤ë¬´í˜• ë°°ì¹˜ ì•± (Job + Task êµ¬ë¶„ ì—†ì´ í™•ì¥ ê°€ëŠ¥)
batchApps:
  enabled: true
  apps:

{{-range $i, $app := until 10 }}

    - name: neo-batch-job-0{{ add $i 1 }}
      # image: neo-batch-job-0{{ add $i 1 }}:0.0.1
      image: 
        repository: neo-audit-log
        tag: 0.0.1
        pullPolicy: 
      restartPolicy: Never
      env: 
        - name: springProfile
          value: local 
        - name: jobCron 
          value: 0, 0/5, 0, 0, 0
      command:
        - "--rtm.batch.job.start=202507091730"
        - "--rtm.batch.job.end=202507091740"
        - "--rtm.batch.job.chunk=200"
        - "--rtm.batch.job.interval=10"
        - "--rtm.batch.job.delay=5"
      service:
        # port: 8080
        port: {{ add 8080 $i }}
      nodeSelector:
        role: work

    - name: neo-batch-task-0{{ add $i 1 }}
      # image: neo-batch-task-0{{ add $i 1 }}:0.0.1
      image: 
        repository: neo-audit-log
        tag: 0.0.1
        pullPolicy: 
      restartPolicy: Never
      env: 
        - name: springProfile
          value: local 
        - name: jobCron 
          value: 0, 0/5, 0, 0, 0
      command:
        - "--spring.cloud.task.name=task01"
      service:
        # port: 8090
        port: {{ add 8090 $i }}
      nodeSelector:
        role: work

{{- end }}

    # ... ë‚˜ë¨¸ì§€ ì•±ë„ ë™ì¼í•˜ê²Œ í™•ì¥ ê°€ëŠ¥

# âœ¨ SCDF ê´€ë ¨ ì„¤ì • (ì¶”í›„ scdf section ì¶”ê°€ ì˜ˆì •)
scdf:
  enabled: true
  nodeSelector:
    role: main
  externalDatabase:
    host: mariadb
    port: 3306
    user: neodain
    password: Kht72@eye1
    database: demo
  skipper:
    enabled: true

